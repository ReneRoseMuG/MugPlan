# FT (04): Tourenplanung

## Ziel / Zweck

Dieses Feature ermöglicht der Disposition die Verwaltung von Touren zur logischen Gruppierung von Terminen im Kalender. Touren dienen ausschließlich der organisatorischen Bündelung und der visuellen Orientierung innerhalb der Terminplanung.

## Fachliche Beschreibung

Eine Tour ist eine abstrakte Planungseinheit, mit der mehrere Termine logisch zusammengefasst werden können. Touren haben keinen fachlichen Bezug zu Fahrzeugen, Routen oder Arbeitszeiten. Sie dienen ausschließlich der Strukturierung und besseren Übersicht in der Terminplanung. Touren fungieren auch als Gruppenvorlage für die zeitweilige Gruppierung von Mitarbeitern.

Termine können einer Tour zugeordnet oder aus einer Tour entfernt werden. Alle Termine einer Tour teilen sich eine gemeinsame Farbe, die im Kalender als zentrales visuelles Ordnungsmerkmal dient. Zusätzlich zeigen Termine ihre Postleitzahl an, um eine grobe räumliche Orientierung innerhalb einer Tour zu ermöglichen.

Touren können manuell angelegt und bearbeitet werden. Eine Übersicht ermöglicht es, alle einer Tour zugeordneten Termine gesammelt anzuzeigen. Touren enthalten selbst keine Terminlogik und keine zeitliche oder räumliche Auswertungsfunktion.

## Regeln & Randbedingungen

- Eine Tour dient ausschließlich der organisatorischen Gruppierung von Terminen.
- Touren sind nicht an Fahrzeuge oder feste Ziele gebunden.
- Ein Termin kann maximal einer Tour zugeordnet sein.
- Eine Tour kann mehrere Termine enthalten.
- Die Farbe einer Tour ist das primäre visuelle Identifikationsmerkmal im Kalender.
- Touren enthalten keine Routen-, Zeit- oder Entfernungslogik.
- Touren dürfen keine implizite Fahrzeugbedeutung haben.
- Eine Tour kann nur gelöscht werden, wenn ihr keine Termine mehr zugeordnet sind.
- Tour erhält eine **Mitarbeiterzuordnung** (0..n).
- **Mitarbeiter kann nur einer Tour angehören** (0..1 aus Sicht Mitarbeiter).
- Mehrere Mitarbeiter können einer Tour zugewiesen werden
- Löschen einer Tour: weiterhin nur, wenn keine Termine zugeordnet sind, aber zusätzlich: **keine Kaskade**, sondern nur Mitarbeiter.Tour_ID auf NULL/0 setzen. (Die bestehende Löschregel “nur wenn keine Termine” steht bereits drin.)

## **Use Cases**

### **UC: Tour anlegen - implementiert**

**Akteur: [RO (01): Disponent](https://www.notion.so/RO-01-Disponent-2eada094354e80c1af01d041b1bda7af?pvs=21)** 

**Ziel**

Anlegen einer neuen Tour zur Gruppierung von Terminen im Kalender.

**Beschreibung**

Die Disponentin legt eine neue Tour an, um mehrere Termine logisch zusammenzufassen und im Kalender visuell zu kennzeichnen. Die Tour dient ausschließlich der Organisation und Orientierung und ist nicht an Personal, Fahrzeuge oder Routen gebunden.

**Vorbedingungen**

- Die Disponentin ist angemeldet
- Das System ist betriebsbereit
- Die Tourenverwaltung ist verfügbar

**Ablauf**

1. Die Disponentin öffnet die Tourenverwaltung
2. Die Disponentin wählt die Funktion „Tour anlegen“
3. Das System zeigt ein Eingabeformular für die Tour
4. Die Disponentin gibt einen Namen für die Tour ein
5. Die Disponentin wählt eine Farbe aus
6. Optional hinterlegt die Disponentin eine Beschreibung
7. Die Disponentin bestätigt die Eingabe
8. Das System legt die Tour an und speichert sie

**Alternativabläufe**

- Die Disponentin bricht den Vorgang vor dem Speichern ab
- Pflichtfelder sind nicht ausgefüllt, das System fordert zur Korrektur auf
- Die gewählte Farbe ist nicht verfügbar, das System schlägt eine Alternative vor

**Ergebnis**

Die neue Tour ist im System angelegt, aktiv und kann Terminen zugeordnet werden.

### **UC: Tour bearbeiten - implementiert**

**Akteur: [RO (01): Disponent](https://www.notion.so/RO-01-Disponent-2eada094354e80c1af01d041b1bda7af?pvs=21)** 

**Ziel**

Ändern der Eigenschaften einer bestehenden Tour.

**Beschreibung**

Die Disponentin bearbeitet eine vorhandene Tour, um deren Name, Farbe oder Beschreibung anzupassen. Die Änderungen dienen der besseren Übersicht und Organisation bereits bestehender oder geplanter Termine.

**Vorbedingungen**

- Die Disponentin ist angemeldet
- Mindestens eine Tour ist im System vorhanden
- Die Tourenverwaltung ist verfügbar

**Ablauf**

1. Die Disponentin öffnet die Tourenverwaltung
2. Die Disponentin wählt eine bestehende Tour aus
3. Die Disponentin wählt die Funktion „Tour bearbeiten“
4. Das System zeigt die aktuellen Tourdaten an
5. Die Disponentin ändert Name, Farbe und/oder Beschreibung
6. Die Disponentin bestätigt die Änderungen
7. Das System speichert die Änderungen

**Alternativabläufe**

- Die Disponentin bricht den Bearbeitungsvorgang ab
- Pflichtfelder sind ungültig oder leer, das System fordert zur Korrektur auf
- Die gewählte Farbe ist nicht verfügbar, das System verlangt eine neue Auswahl

**Ergebnis**

Die Tour ist aktualisiert. Alle zugeordneten Termine werden sofort mit den geänderten Eigenschaften dargestellt.

### UC: Mitarbeiter einer Tour zuweisen

**Akteur**

[RO (01): Disponent](https://www.notion.so/RO-01-Disponent-2eada094354e80c1af01d041b1bda7af?pvs=21) 

**Ziel**

Eine bestehende Tour-Vorlage anpassen, z. B. Mitarbeiter hinzufügen oder entfernen.

**Vorbedingungen**

- Die Tour-Vorlage existiert.
- Der Disponent ist berechtigt.

**Auslöser**

Der Disponent wählt eine bestehende Tour zur Bearbeitung aus.

**Ablauf**

1. Der Disponent öffnet eine >Tour 
2. Das System zeigt zugeordnete Mitarbeiter an.
3. Der Disponent ändert  Mitarbeiterliste.
4. Der Disponent bestätigt die Änderungen.
5. Das System speichert die aktualisierte Tour.

**Alternativabläufe**

- Abbruch: Das System verwirft die Änderungen.
- Ungültige Auswahl (z. B. kein Mitarbeiter): Das System speichert nicht.

**Ergebnis**

Die Tour-Vorlage ist aktualisiert und steht in der neuen Zusammensetzung zur Verfügung.

## **Zusammenfassung (fachlich klar)**

- Touren sind **reine Ordnungs- und Orientierungseinheiten**
- Sie bündeln Termine logisch und visuell
- Sie haben **keine fachliche Bedeutung** für Personal, Fahrzeuge oder Routen
- FT (04) ergänzt FT (01) und FT (03), ohne deren Aufgaben zu überschneiden

## Implementierungslog

## Ausgangslage (Erste Iteration)

### Was bereits implementiert war:

- ✅ Datenbank-Tabelle `tours` (id, name, color)
- ✅ API-Endpunkte (GET, POST, PATCH, DELETE)
- ✅ Frontend-Anbindung mit reaktiver Datenaktualisierung
- ✅ Name-Feld als ReadOnly-Label (automatische Benennung)
- ✅ Farbe editierbar mit Color-Picker
- ✅ Guardrails in replit.md verlinkt

### Automatische Benennung:

Neue Touren werden basierend auf `max(id) + 1` benannt, sodass nach Löschungen keine Duplikate entstehen.

---

## Anforderungen aus der ersten Iteration

1. **Umbenennung**: "Team Vorlagen" → "Teams"
2. **Einheitliches Design**: Tour-Verwaltung soll identisch zur Team-Verwaltung aussehen
3. **Tour-Karte**: Color-Picker als Button über volle Breite am unteren Rand
4. **Mitarbeiterliste**: Zentrales Element auf beiden Karten
5. **Edit-Button**: Für Mitarbeiterliste auf Team- und Tour-Karten
6. **FK-Relationen**: Werden später am Employee-Objekt umgesetzt

---

## Durchgeführte Änderungen (Januar 2026)

### 1. Navigation angepasst

- **Sidebar.tsx**: "Team Vorlagen" → "Teams" umbenannt
- **Sidebar.tsx**: "Abwesenheiten" aus Navigation entfernt
- Nicht mehr benötigter Import (CalendarOff) entfernt

### 2. TeamManagement.tsx überarbeitet

- Titel von "Team Vorlagen" auf "Teams" geändert
- Edit-Button (Pencil Icon) zur TeamCard hinzugefügt
- **EditTeamMembersDialog** implementiert:
    - Öffnet sich beim Klick auf Edit-Button
    - Checkbox-Auswahl für Mitarbeiter
    - Bereits zugewiesene Mitarbeiter (in anderen Teams) ausgegraut
    - Speichern-Button aktualisiert Mitarbeiterliste

### 3. TourManagement.tsx komplett redesigned

- **TourCard** nach TeamCard-Vorbild umstrukturiert:
    - Header mit Tourfarbe + Name + Delete-Button
    - Weißer Content-Bereich darunter
    - Mitarbeiterliste mit UserCheck Icons als zentrales Element
    - Color-Picker als Button über volle Breite am unteren Rand
- Edit-Button (Pencil Icon) hinzugefügt
- **EditTourMembersDialog** implementiert:
    - Gleiche Logik wie EditTeamMembersDialog
    - Checkbox-Auswahl für Mitarbeiter
    - Bereits zugewiesene Mitarbeiter (in anderen Touren) ausgegraut
- **Demo-Daten** für Mitarbeiter (5 Beispiel-Mitarbeiter)
- Tour-Mitarbeiter werden im lokalen State verwaltet (tourMembers Record)

### 4. Dokumentation aktualisiert

- **replit.md**: Team- und Tour-Management Abschnitte aktualisiert

---

## Technische Details

### Geänderte Dateien:

| Datei | Änderung |
| --- | --- |
| `client/src/components/Sidebar.tsx` | Navigation angepasst |
| `client/src/components/TeamManagement.tsx` | Titel + EditDialog hinzugefügt |
| `client/src/components/TourManagement.tsx` | Komplettes Redesign |
| `replit.md` | Dokumentation aktualisiert |

### Neue Komponenten:

- `EditTeamMembersDialog` in TeamManagement.tsx
- `EditTourMembersDialog` in TourManagement.tsx

### SQL Schemas (für spätere DB-Integration):

**Tour:**

```
CREATETABLEIFNOTEXISTS tour(
  id          BIGSERIALPRIMARYKEY,
  name        TEXTNOTNULL,
  color       TEXTNOTNULL,
  description TEXTNULL,
  created_at  TIMESTAMPTZNOTNULLDEFAULT NOW(),
  updated_at  TIMESTAMPTZNOTNULLDEFAULT NOW()
);

```

**Team:**

```
CREATETABLEIFNOTEXISTS team(
  id          BIGSERIALPRIMARYKEY,
  name        TEXTNOTNULL,
  description TEXTNULL,
  is_activeBOOLEANNOTNULLDEFAULTTRUE,
  created_at  TIMESTAMPTZNOTNULLDEFAULT NOW(),
  updated_at  TIMESTAMPTZNOTNULLDEFAULT NOW()
);

```

---

## Offene Punkte für zukünftige Iterationen

- [ ]  FK-Relationen zwischen Employee, Tour und Team implementieren
- [ ]  Team-Verwaltung mit Datenbank verbinden (aktuell nur Demo)
- [ ]  Tour-Mitarbeiterzuweisungen persistieren
- [ ]  Team-Tabelle in Datenbank anlegen

---